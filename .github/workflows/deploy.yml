name: CI/CD Pipeline
on: 
  push:
    branches:
      - main

jobs:
  react-deploy:
    name: 部署React到GitHub Pages
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm install
      - run: npm run build
      - uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: gh-pages
          folder: dist

  notes-deploy:
    name: 同步笔记到独立分支
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: 准备笔记内容
        run: |
          # 创建临时目录存放笔记
          mkdir -p notes-temp
          cp -r src/notes/* notes-temp/

      - uses: JamesIves/github-pages-deploy-action@v4
        with:
          branch: notes                 # 目标分支名称
          folder: notes-temp            # 源文件目录
          clean: true                   # 清空目标分支旧内容
          target-folder: "/"            # 部署到根目录
          token: ${{ secrets.GITHUB_TOKEN }}  # 使用内置权限